name: Issue Management Automation
on:
  issues:
    types: [opened, labeled]

jobs:
  create-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install dependencies
        run: npm install
      - name: Create labels
        run: node .github/scripts/create-labels.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  issue-triage:
    needs: create-labels
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install dependencies
        run: npm install
      - name: Run triage script
        run: node .github/scripts/triage.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  task-breakdown:
    needs: issue-triage
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install dependencies
        run: npm install
      - name: Run breakdown script
        run: node .github/scripts/breakdown.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  auto-response:
    needs: [issue-triage, task-breakdown]
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install dependencies
        run: npm install
      - name: Run auto-response script
        run: node .github/scripts/auto-response.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}